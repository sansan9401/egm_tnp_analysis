import ROOT as rt
from array import array
import sys

if len(sys.argv)<2:
    print("Usage: python AddBranchIsTriggerOn2018.py [ROOTFILEPATH]")
    exit(1)

## cms json when HLT_Ele27 on (2018)
js_Ele27={
    "315257": [[1, 88], [91, 92]],
    "315259": [[1, 172]],
    "315264": [[32, 261]],
    "315265": [[4, 58]],
    "315267": [[1, 244]],
    "315270": [[1, 633]],
    "315322": [[23, 118], [122, 1354]],
    "315339": [[37, 654]],
    "315357": [[44, 732], [736, 770], [780, 831]],
    "315361": [[40, 619]],
    "315363": [[1, 35], [37, 47], [49, 67], [69, 80], [82, 90]],
    "315366": [[10, 61], [67, 750]],
    "315420": [[28, 920], [924, 942], [954, 1748]],
    "315641": [[1, 4]],
    "319909": [[1, 7]],
    "320807": [[1, 7]],
    "321165": [[1, 2]]
}

## cms json when HLT_Ele28 on (2018)
js_Ele28={
    "319909": [[1, 7]],
    "320807": [[1, 7]],
    "321165": [[1, 2]],
    "321397": [[1, 365]],
    "321414": [[31, 1273]],
    "321415": [[1, 804]],
    "321431": [[30, 182]],
    "321432": [[1, 47]],
    "321433": [[1, 125]],
    "321434": [[1, 642]],
    "321436": [[1, 710]],
    "321457": [[43, 451], [453, 1887]],
    "321461": [[1, 149]],
    "321475": [[50, 518], [526, 2084]],
    "321710": [[1, 52]],
    "321712": [[1, 2], [16, 54], [57, 115], [117, 263]],
    "321730": [[2, 257], [259, 288]],
    "321732": [[1, 127], [129, 181], [185, 189], [192, 245], [248, 252], [254, 373], [375, 381], [386, 386], [389, 392], [395, 424], [426, 432], [434, 448], [450, 452], [454, 459], [467, 586], [589, 680], [682, 686], [689, 903], [905, 973], [975, 1443]],
    "321735": [[1, 146]],
    "321755": [[33, 361], [363, 470], [472, 473], [475, 487], [489, 722]],
    "321758": [[1, 47], [49, 75], [77, 121], [128, 130], [146, 148], [151, 155], [161, 165], [168, 184]],
    "321760": [[1, 171], [175, 205], [207, 238], [240, 258], [260, 420], [422, 520], [526, 586], [588, 593], [598, 602], [604, 607], [613, 716], [719, 721], [727, 788], [794, 818], [822, 824], [828, 830], [834, 836], [840, 841], [845, 855]],
    "321773": [[11, 14], [25, 35], [39, 52], [54, 79]],
    "321774": [[1, 12], [14, 52], [54, 119]],
    "321775": [[1, 12], [14, 14]],
    "321776": [[1, 12], [15, 19], [30, 42]],
    "321777": [[1, 81], [83, 169], [174, 176], [192, 207]],
    "321778": [[8, 143]],
    "321780": [[1, 332], [336, 338], [342, 346], [351, 357], [359, 360], [362, 371], [374, 383], [392, 412], [414, 420], [422, 493], [496, 499], [502, 503], [505, 508], [517, 518]],
    "321781": [[6, 37], [53, 56], [58, 66], [69, 69], [77, 180], [186, 209], [212, 265], [269, 274], [276, 290], [293, 312], [316, 410], [412, 427]],
    "321813": [[32, 352]],
    "321815": [[1, 23]],
    "321817": [[1, 536]],
    "321818": [[1, 690]],
    "321820": [[1, 214]],
    "321831": [[25, 776]],
    "321832": [[1, 389], [403, 507]],
    "321833": [[1, 398]],
    "321834": [[1, 333]],
    "321879": [[39, 47], [50, 52], [55, 68], [71, 73], [77, 89], [93, 95], [99, 111], [114, 116], [120, 132], [136, 138], [141, 154], [157, 159], [163, 175], [178, 181], [185, 197], [200, 202], [207, 218], [222, 347]],
    "321880": [[1, 41], [44, 132]],
    "321887": [[54, 948]],
    "321908": [[43, 468]],
    "321909": [[1, 208], [210, 1654]],
    "321917": [[4, 156], [164, 808]],
    "321919": [[1, 6]],
    "321933": [[43, 232], [235, 326]],
    "321960": [[18, 41]],
    "321961": [[1, 354]],
    "321973": [[37, 746], [748, 968], [972, 1248]],
    "321975": [[1, 866]],
    "321988": [[45, 996], [1106, 1482]],
    "321990": [[1, 471]],
    "322013": [[14, 22]],
    "322014": [[1, 17]],
    "322022": [[42, 185], [201, 1805]],
    "322040": [[32, 70]],
    "322057": [[38, 58]],
    "322068": [[51, 724]],
    "322079": [[39, 200], [216, 393], [409, 428]],
    "322106": [[48, 871]],
    "322113": [[48, 155]],
    "322118": [[1, 516], [530, 874]],
    "322179": [[43, 820], [823, 1783]],
    "322201": [[39, 260]],
    "322204": [[1, 280], [282, 301], [303, 331], [337, 1143]],
    "322222": [[1, 526]],
    "322252": [[42, 1586]],
    "322317": [[48, 101]],
    "322319": [[1, 161]],
    "322322": [[1, 170], [267, 1203]],
    "322324": [[1, 416]],
    "322332": [[37, 1055]],
    "322348": [[40, 1505]],
    "322355": [[36, 134]],
    "322356": [[1, 779]],
    "322381": [[45, 577]],
    "322407": [[46, 582]],
    "322430": [[46, 784]],
    "322431": [[1, 53], [59, 1166]],
    "322480": [[60, 400]],
    "322492": [[1, 1386]],
    "322510": [[37, 45]],
    "322599": [[43, 294]],
    "322602": [[1, 69]],
    "322603": [[1, 10]],
    "322605": [[1, 280]],
    "322617": [[1, 601]],
    "322625": [[41, 484], [492, 1167]],
    "322633": [[1, 249]],
    "323414": [[1, 40]],
    "323423": [[1, 136]],
    "323470": [[38, 172], [176, 218], [223, 265]],
    "323471": [[1, 232]],
    "323472": [[1, 64]],
    "323473": [[1, 227]],
    "323474": [[1, 352]],
    "323475": [[1, 77]],
    "323487": [[42, 177], [184, 498]],
    "323488": [[1, 514], [555, 734], [738, 788]],
    "323492": [[1, 30]],
    "323493": [[1, 140]],
    "323495": [[1, 187]],
    "323524": [[25, 555]],
    "323525": [[1, 91], [97, 1122]],
    "323526": [[1, 248], [253, 466]],
    "323693": [[38, 151]],
    "323696": [[1, 257]],
    "323702": [[1, 808]],
    "323725": [[18, 346]],
    "323726": [[1, 53]],
    "323727": [[1, 83], [88, 677], [682, 813], [819, 822], [826, 987]],
    "323755": [[27, 815], [818, 823], [826, 826], [828, 830], [833, 861], [864, 964]],
    "323775": [[38, 81], [84, 168]],
    "323778": [[1, 934]],
    "323790": [[45, 944]],
    "323794": [[1, 68]],
    "323841": [[46, 509]],
    "323857": [[1, 357]],
    "323940": [[49, 1567]],
    "323954": [[1, 77]],
    "323976": [[31, 77]],
    "323978": [[1, 68]],
    "323980": [[1, 199]],
    "323983": [[1, 187]],
    "323997": [[1, 498]],
    "324021": [[44, 815]],
    "324022": [[1, 554]],
    "324077": [[54, 710], [712, 753]],
    "324201": [[20, 834], [837, 1376]],
    "324202": [[1, 238]],
    "324205": [[1, 160]],
    "324206": [[1, 141]],
    "324207": [[1, 33]],
    "324209": [[1, 142]],
    "324237": [[33, 236]],
    "324245": [[23, 1681]],
    "324293": [[39, 1440], [1442, 2176], [2178, 2342]],
    "324315": [[1, 200], [203, 204]],
    "324318": [[1, 332]],
    "324420": [[1, 625]],
    "324729": [[1, 193]],
    "324747": [[63, 1135]],
    "324764": [[1, 147]],
    "324765": [[1, 478]],
    "324769": [[1, 328]],
    "324772": [[1, 165]],
    "324785": [[77, 659]],
    "324791": [[1, 1217]],
    "324835": [[40, 230], [302, 367]],
    "324840": [[1, 93]],
    "324841": [[1, 1347]],
    "324846": [[1, 151], [154, 517]],
    "324878": [[62, 111], [113, 175], [180, 1800]],
    "324897": [[30, 170]],
    "324970": [[1, 425], [428, 598], [606, 632], [634, 1529], [1532, 2195]],
    "324980": [[39, 917], [919, 954], [956, 968], [1005, 1042], [1044, 2340]],
    "324997": [[29, 144]],
    "324998": [[1, 362]],
    "324999": [[1, 14]],
    "325000": [[1, 371]],
    "325001": [[1, 105], [108, 171], [173, 595]],
    "325022": [[45, 1594]],
    "325057": [[42, 383]],
    "325097": [[40, 96]],
    "325098": [[1, 8]],
    "325099": [[1, 388]],
    "325100": [[1, 254]],
    "325101": [[1, 462], [464, 483]],
    "325110": [[1, 16]],
    "325117": [[3, 533]],
    "325159": [[48, 260]],
    "325168": [[1, 18]],
    "325169": [[1, 23]],
    "325170": [[1, 692], [694, 1204]],
    "325172": [[4, 267], [269, 476]]
}

f=rt.TFile(sys.argv[1],"update")
tree=f.Get("tnpEleTrig/fitter_tree")
if hasattr(tree,"IsEle27On"):
    print("This tree already has IsEle27On")
    exit(1)
if hasattr(tree,"IsEle28On"):
    print("This tree already has IsEle28On")
    exit(1)

IsMC=False
if hasattr(tree,"mcTrue"):
    IsMC=True
    print("This is MC, set IsEleOn=1")

IsEle27On=array("b",[True])
bIsEle27On=tree.Branch("IsEle27On",IsEle27On,"IsEle27On/O")
IsEle28On=array("b",[True])
bIsEle28On=tree.Branch("IsEle28On",IsEle28On,"IsEle28On/O")

for i in range(tree.GetEntries()):
    tree.GetEntry(i)
    IsEle27On[0]=False
    IsEle28On[0]=False
    if IsMC:
        IsEle27On[0]=True
        IsEle28On[0]=True
    else:
        if str(tree.run) in js_Ele27:
            for pair in js_Ele27[str(tree.run)]:
                if tree.lumi>=pair[0] and tree.lumi<=pair[1]:
                    IsEle27On[0]=True
                    break
        if str(tree.run) in js_Ele28:
            for pair in js_Ele28[str(tree.run)]:
                if tree.lumi>=pair[0] and tree.lumi<=pair[1]:
                    IsEle28On[0]=True
                    break

    bIsEle27On.Fill()
    bIsEle28On.Fill()

f.cd("tnpEleTrig")
tree.Write()
f.Close()
